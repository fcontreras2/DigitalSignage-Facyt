!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?module.exports=factory(require("jquery")):factory(window.jQuery)}(function($){"use strict";$.fn.fileinputLocales={};var NAMESPACE,objUrl,compare,isIE,isEdge,handler,previewCache,getNum,hasFileAPISupport,hasDragDropSupport,hasFileUploadSupport,addCss,STYLE_SETTING,OBJECT_PARAMS,DEFAULT_PREVIEW,defaultFileActionSettings,tMain1,tMain2,tPreview,tIcon,tClose,tCaption,tBtnDefault,tBtnLink,tBtnBrowse,tModal,tProgress,tFooter,tActions,tActionDelete,tActionUpload,tZoom,tGeneric,tHtml,tImage,tText,tVideo,tAudio,tFlash,tObject,tOther,defaultLayoutTemplates,defaultPreviewTemplates,defaultPreviewTypes,defaultPreviewSettings,FileInput,defaultFileTypeSettings,isEmpty,isArray,isSet,getElement,uniqId,htmlEncode,replaceTags,cleanMemory;NAMESPACE=".fileinput",objUrl=window.URL||window.webkitURL,compare=function(input,str,exact){return void 0!==input&&(exact?input===str:input.match(str))},isIE=function(ver){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===ver)return new RegExp("msie\\s"+ver,"i").test(navigator.userAgent);var status,div=document.createElement("div");return div.innerHTML="<!--[if IE "+ver+"]> <i></i> <![endif]-->",status=div.getElementsByTagName("i").length,document.body.appendChild(div),div.parentNode.removeChild(div),status},isEdge=function(){return new RegExp("Edge/[0-9]+","i").test(navigator.userAgent)},handler=function($el,event,callback,skipNS){var ev=skipNS?event:event.split(" ").join(NAMESPACE+" ")+NAMESPACE;$el.off(ev).on(ev,callback)},previewCache={data:{},init:function(obj){var content=obj.initialPreview,id=obj.id;content.length>0&&!isArray(content)&&(content=content.split(obj.initialPreviewDelimiter)),previewCache.data[id]={content:content,config:obj.initialPreviewConfig,tags:obj.initialPreviewThumbTags,delimiter:obj.initialPreviewDelimiter,template:obj.previewGenericTemplate,msg:function(n){return obj._getMsgSelected(n)},initId:obj.previewInitId,footer:obj._getLayoutTemplate("footer").replace(/\{progress}/g,obj._renderThumbProgress()),isDelete:obj.initialPreviewShowDelete,caption:obj.initialCaption,actions:function(showUpload,showDelete,disabled,url,key){return obj._renderFileActions(showUpload,showDelete,disabled,url,key)}}},fetch:function(id){return previewCache.data[id].content.filter(function(n){return null!==n})},count:function(id,all){return previewCache.data[id]&&previewCache.data[id].content?all?previewCache.data[id].content.length:previewCache.fetch(id).length:0},get:function(id,i,isDisabled){var out,$tmp,ind="init_"+i,data=previewCache.data[id],config=data.config[i],previewId=data.initId+"-"+ind,frameClass=" file-preview-initial";return isDisabled=void 0===isDisabled?!0:isDisabled,null===data.content[i]?"":(isEmpty(config)||isEmpty(config.frameClass)||(frameClass+=" "+config.frameClass),out=data.template.replace(/\{previewId}/g,previewId).replace(/\{frameClass}/g,frameClass).replace(/\{fileindex}/g,ind).replace(/\{content}/g,data.content[i]).replace(/\{footer}/g,previewCache.footer(id,i,isDisabled)),data.tags.length&&data.tags[i]&&(out=replaceTags(out,data.tags[i])),isEmpty(config)||isEmpty(config.frameAttr)||($tmp=$(document.createElement("div")).html(out),$tmp.find(".file-preview-initial").attr(config.frameAttr),out=$tmp.html(),$tmp.remove()),out)},add:function(id,content,config,tags,append){var index,data=$.extend(!0,{},previewCache.data[id]);return isArray(content)||(content=content.split(data.delimiter)),append?(index=data.content.push(content)-1,data.config[index]=config,data.tags[index]=tags):(index=content.length,data.content=content,data.config=config,data.tags=tags),previewCache.data[id]=data,index},set:function(id,content,config,tags,append){var i,chk,data=$.extend(!0,{},previewCache.data[id]);if(content&&content.length&&(isArray(content)||(content=content.split(data.delimiter)),chk=content.filter(function(n){return null!==n}),chk.length)){if(void 0===data.content&&(data.content=[]),void 0===data.config&&(data.config=[]),void 0===data.tags&&(data.tags=[]),append){for(i=0;i<content.length;i++)content[i]&&data.content.push(content[i]);for(i=0;i<config.length;i++)config[i]&&data.config.push(config[i]);for(i=0;i<tags.length;i++)tags[i]&&data.tags.push(tags[i])}else data.content=content,data.config=config,data.tags=tags;previewCache.data[id]=data}},unset:function(id,index){var chk=previewCache.count(id);if(chk){if(1===chk)return previewCache.data[id].content=[],void(previewCache.data[id].config=[]);previewCache.data[id].content[index]=null,previewCache.data[id].config[index]=null}},out:function(id){var caption,html="",data=previewCache.data[id],len=previewCache.count(id,!0);if(0===len)return{content:"",caption:""};for(var i=0;len>i;i++)html+=previewCache.get(id,i);return caption=data.msg(previewCache.count(id)),{content:html,caption:caption}},footer:function(id,i,isDisabled){var data=previewCache.data[id];if(isDisabled=void 0===isDisabled?!0:isDisabled,0===data.config.length||isEmpty(data.config[i]))return"";var config=data.config[i],caption=isSet("caption",config)?config.caption:"",width=isSet("width",config)?config.width:"auto",url=isSet("url",config)?config.url:!1,key=isSet("key",config)?config.key:null,disabled=url===!1&&isDisabled,actions=data.isDelete?data.actions(!1,!0,disabled,url,key):"",footer=data.footer.replace(/\{actions}/g,actions);return footer.replace(/\{caption}/g,caption).replace(/\{width}/g,width).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}},getNum=function(num,def){return def=def||0,"number"==typeof num?num:("string"==typeof num&&(num=parseFloat(num)),isNaN(num)?def:num)},hasFileAPISupport=function(){return!(!window.File||!window.FileReader)},hasDragDropSupport=function(){var div=document.createElement("div");return!isIE(9)&&!isEdge()&&(void 0!==div.draggable||void 0!==div.ondragstart&&void 0!==div.ondrop)},hasFileUploadSupport=function(){return hasFileAPISupport()&&window.FormData},addCss=function($el,css){$el.removeClass(css).addClass(css)},STYLE_SETTING='style="width:{width};height:{height};"',OBJECT_PARAMS='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',DEFAULT_PREVIEW='<div class="file-preview-other">\n   <span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',defaultFileActionSettings={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},tMain1='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',tMain2='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',tPreview='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',tClose='<div class="close fileinput-remove">&times;</div>\n',tIcon='<span class="glyphicon glyphicon-file kv-caption-icon"></span>',tCaption='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"></div>\n</div>\n',tBtnDefault='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon}{label}</button>',tBtnLink='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon}{label}</a>',tBtnBrowse='<div tabindex="500" class="{css}" {status}>{icon}{label}</div>',tModal='<div id="{id}" class="file-preview-detail-modal modal fade" tabindex="-1">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">{heading} <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n           <pre>{body}</pre>\n      </div>\n    </div>\n  </div>\n</div>',tProgress='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',tFooter='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}</div>\n    {progress} {actions}\n</div>',tActions='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',tActionDelete='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',tActionUpload='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',tZoom='<button type="button" class="btn btn-default btn-xs btn-block" title="{zoomTitle}: {caption}" onclick="{dialog}">\n   {zoomInd}\n</button>\n',tGeneric='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',tHtml='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object class="file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n       '+DEFAULT_PREVIEW+"\n    </object>\n   {footer}\n</div>",tImage='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+STYLE_SETTING+">\n   {footer}\n</div>\n",tText='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <pre class="file-preview-text" title="{caption}" '+STYLE_SETTING+">{data}</pre>\n   {zoom}\n   {footer}\n</div>",tVideo='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+DEFAULT_PREVIEW+"\n   </video>\n   {footer}\n</div>\n",tAudio='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+DEFAULT_PREVIEW+"\n   </audio>\n   {footer}\n</div>",tFlash='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <object class="file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+OBJECT_PARAMS+"       "+DEFAULT_PREVIEW+"\n   </object>\n   {footer}\n</div>\n",tObject='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <object class="file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+OBJECT_PARAMS+"         "+DEFAULT_PREVIEW+"\n   </object>\n   {footer}\n</div>",tOther='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <div class="file-preview-other-frame">\n   '+DEFAULT_PREVIEW+'\n   </div>\n   <div class="file-preview-other-footer">{footer}</div>\n</div>',defaultLayoutTemplates={main1:tMain1,main2:tMain2,preview:tPreview,close:tClose,zoom:tZoom,icon:tIcon,caption:tCaption,modal:tModal,progress:tProgress,footer:tFooter,actions:tActions,actionDelete:tActionDelete,actionUpload:tActionUpload,btnDefault:tBtnDefault,btnLink:tBtnLink,btnBrowse:tBtnBrowse},defaultPreviewTemplates={generic:tGeneric,html:tHtml,image:tImage,text:tText,video:tVideo,audio:tAudio,flash:tFlash,object:tObject,other:tOther},defaultPreviewTypes=["image","html","text","video","audio","flash","object"],defaultPreviewSettings={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"136px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},defaultFileTypeSettings={image:function(vType,vName){return compare(vType,"image.*")||compare(vName,/\.(gif|png|jpe?g)$/i)},html:function(vType,vName){return compare(vType,"text/html")||compare(vName,/\.(htm|html)$/i)},text:function(vType,vName){return compare(vType,"text.*")||compare(vType,/\.(xml|javascript)$/i)||compare(vName,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(vType,vName){return compare(vType,"video.*")&&(compare(vType,/(ogg|mp4|mp?g|webm|3gp)$/i)||compare(vName,/\.(og?|mp4|webm|mp?g|3gp)$/i))},audio:function(vType,vName){return compare(vType,"audio.*")&&(compare(vType,/(ogg|mp3|mp?g|wav)$/i)||compare(vName,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(vType,vName){return compare(vType,"application/x-shockwave-flash",!0)||compare(vName,/\.(swf)$/i)},object:function(vType,vName){return compare(vType,"application/pdf",!0)||compare(vName,/\.(pdf)$/i)},other:function(){return!0}},isEmpty=function(value,trim){return void 0===value||null===value||0===value.length||trim&&""===$.trim(value)},isArray=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},isSet=function(needle,haystack){return"object"==typeof haystack&&needle in haystack},getElement=function(options,param,value){return isEmpty(options)||isEmpty(options[param])?value:$(options[param])},uniqId=function(){return Math.round((new Date).getTime()+100*Math.random())},htmlEncode=function(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags=function(str,tags){var out=str;return tags?($.each(tags,function(key,value){"function"==typeof value&&(value=value()),out=out.split(key).join(value)}),out):out},cleanMemory=function($thumb){var data=$thumb.is("img")?$thumb.attr("src"):$thumb.find("source").attr("src");objUrl.revokeObjectURL(data)},FileInput=function(element,options){var self=this;self.$element=$(element),self._validate()&&(self.isPreviewable=hasFileAPISupport(),self.isIE9=isIE(9),self.isIE10=isIE(10),self.isPreviewable||self.isIE9?(self._init(options),self._listen()):self.$element.removeClass("file-loading"))},FileInput.prototype={constructor:FileInput,_init:function(options){var t,self=this,$el=self.$element;$.each(options,function(key,value){switch(key){case"minFileCount":case"maxFileCount":case"maxFileSize":self[key]=getNum(value);break;default:self[key]=value}}),self.fileInputCleared=!1,self.fileBatchCompleted=!0,self.isPreviewable||(self.showPreview=!1),self.uploadFileAttr=isEmpty($el.attr("name"))?"file_data":$el.attr("name"),self.reader=null,self.formdata={},self.clearStack(),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.uploadAsyncCount=0,self.loadedImages=[],self.totalImagesCount=0,self.ajaxRequests=[],self.isError=!1,self.ajaxAborted=!1,self.cancelling=!1,t=self._getLayoutTemplate("progress"),self.progressTemplate=t.replace("{class}",self.progressClass),self.progressCompleteTemplate=t.replace("{class}",self.progressCompleteClass),self.progressErrorTemplate=t.replace("{class}",self.progressErrorClass),self.dropZoneEnabled=hasDragDropSupport()&&self.dropZoneEnabled,self.isDisabled=self.$element.attr("disabled")||self.$element.attr("readonly"),self.isUploadable=hasFileUploadSupport()&&!isEmpty(self.uploadUrl),self.slug="function"==typeof options.slugCallback?options.slugCallback:self._slugDefault,self.mainTemplate=self.showCaption?self._getLayoutTemplate("main1"):self._getLayoutTemplate("main2"),self.captionTemplate=self._getLayoutTemplate("caption"),self.previewGenericTemplate=self._getPreviewTemplate("generic"),self.resizeImage&&(self.maxImageWidth||self.maxImageHeight)&&(self.imageCanvas=document.createElement("canvas"),self.imageCanvasContext=self.imageCanvas.getContext("2d")),isEmpty(self.$element.attr("id"))&&self.$element.attr("id",uniqId()),void 0===self.$container?self.$container=self._createContainer():self._refreshContainer(),self.$dropZone=self.$container.find(".file-drop-zone"),self.$progress=self.$container.find(".kv-upload-progress"),self.$btnUpload=self.$container.find(".fileinput-upload"),self.$captionContainer=getElement(options,"elCaptionContainer",self.$container.find(".file-caption")),self.$caption=getElement(options,"elCaptionText",self.$container.find(".file-caption-name")),self.$previewContainer=getElement(options,"elPreviewContainer",self.$container.find(".file-preview")),self.$preview=getElement(options,"elPreviewImage",self.$container.find(".file-preview-thumbnails")),self.$previewStatus=getElement(options,"elPreviewStatus",self.$container.find(".file-preview-status")),self.$errorContainer=getElement(options,"elErrorContainer",self.$previewContainer.find(".kv-fileinput-error")),isEmpty(self.msgErrorClass)||addCss(self.$errorContainer,self.msgErrorClass),self.$errorContainer.hide(),self.fileActionSettings=$.extend(!0,defaultFileActionSettings,options.fileActionSettings),self.previewInitId="preview-"+uniqId(),self.id=self.$element.attr("id"),previewCache.init(self),self._initPreview(!0),self._initPreviewDeletes(),self.options=options,self._setFileDropZoneTitle(),self.$element.removeClass("file-loading"),self.$element.attr("disabled")&&self.disable()},_validate:function(){var $exception,self=this;return"file"===self.$element.attr("type")?!0:($exception='<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>',self.$element.after($exception),!1)},_errorsExist:function(){var $err,self=this;return self.$errorContainer.find("li").length?!0:($err=$(document.createElement("div")).html(self.$errorContainer.html()),$err.find("span.kv-error-close").remove(),$err.find("ul").remove(),$.trim($err.text()).length?!0:!1)},_errorHandler:function(evt,caption){var self=this,err=evt.target.error;err.code===err.NOT_FOUND_ERR?self._showError(self.msgFileNotFound.replace("{name}",caption)):err.code===err.SECURITY_ERR?self._showError(self.msgFileSecured.replace("{name}",caption)):err.code===err.NOT_READABLE_ERR?self._showError(self.msgFileNotReadable.replace("{name}",caption)):err.code===err.ABORT_ERR?self._showError(self.msgFilePreviewAborted.replace("{name}",caption)):self._showError(self.msgFilePreviewError.replace("{name}",caption))},_addError:function(msg){var self=this,$error=self.$errorContainer;msg&&$error.length&&($error.html(self.errorCloseButton+msg),handler($error.find(".kv-error-close"),"click",function(){$error.fadeOut("slow")}))},_resetErrors:function(fade){var self=this,$error=self.$errorContainer;self.isError=!1,self.$container.removeClass("has-error"),$error.html(""),fade?$error.fadeOut("slow"):$error.hide()},_showFolderError:function(folders){var msg,self=this,$error=self.$errorContainer;folders&&(msg=self.msgFoldersNotAllowed.replace(/\{n}/g,folders),self._addError(msg),addCss(self.$container,"has-error"),$error.fadeIn(800),self._raise("filefoldererror",[folders,msg]))},_showUploadError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileuploaderror",e=params&&params.id?'<li data-file-id="'+params.id+'">'+msg+"</li>":"<li>"+msg+"</li>";return 0===$error.find("ul").length?self._addError("<ul>"+e+"</ul>"):$error.find("ul").append(e),$error.fadeIn(800),self._raise(ev,[params,msg]),self.$container.removeClass("file-input-new"),addCss(self.$container,"has-error"),!0},_showError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileerror";return params=params||{},params.reader=self.reader,self._addError(msg),$error.fadeIn(800),self._raise(ev,[params,msg]),self.isUploadable||self._clearFileInput(),self.$container.removeClass("file-input-new"),addCss(self.$container,"has-error"),self.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(params){var self=this,label=self.minFileCount>1?self.filePlural:self.fileSingle,msg=self.msgFilesTooLess.replace("{n}",self.minFileCount).replace("{files}",label),$error=self.$errorContainer;self._addError(msg),self.isError=!0,self._updateFileDetails(0),$error.fadeIn(800),self._raise("fileerror",[params,msg]),self._clearFileInput(),addCss(self.$container,"has-error")},_parseError:function(jqXHR,errorThrown,fileName){var self=this,errMsg=$.trim(errorThrown+""),dot="."===errMsg.slice(-1)?"":".",text=void 0!==jqXHR.responseJSON&&void 0!==jqXHR.responseJSON.error?jqXHR.responseJSON.error:jqXHR.responseText;return self.cancelling&&self.msgUploadAborted&&(errMsg=self.msgUploadAborted),self.showAjaxErrorDetails&&text?(text=$.trim(text.replace(/\n\s*\n/g,"\n")),text=text.length>0?"<pre>"+text+"</pre>":"",errMsg+=dot+text):errMsg+=dot,self.cancelling=!1,fileName?"<b>"+fileName+": </b>"+errMsg:errMsg},_parseFileType:function(file){var isValid,vType,cat,i,self=this;for(i=0;i<defaultPreviewTypes.length;i+=1)if(cat=defaultPreviewTypes[i],isValid=isSet(cat,self.fileTypeSettings)?self.fileTypeSettings[cat]:defaultFileTypeSettings[cat],vType=isValid(file.type,file.name)?cat:"",!isEmpty(vType))return vType;return"other"},_parseFilePreviewIcon:function(content,fname){var ext,self=this,icn=self.previewFileIcon;return fname&&fname.indexOf(".")>-1&&(ext=fname.split(".").pop(),self.previewFileIconSettings&&self.previewFileIconSettings[ext]&&(icn=self.previewFileIconSettings[ext]),self.previewFileExtSettings&&$.each(self.previewFileExtSettings,function(key,func){self.previewFileIconSettings[key]&&func(ext)&&(icn=self.previewFileIconSettings[key])})),content.indexOf("{previewFileIcon}")>-1?content.replace(/\{previewFileIconClass}/g,self.previewFileIconClass).replace(/\{previewFileIcon}/g,icn):content},_raise:function(event,params){var self=this,e=$.Event(event);if(void 0!==params?self.$element.trigger(e,params):self.$element.trigger(e),e.isDefaultPrevented())return!1;if(!e.result)return e.result;switch(event){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:self.ajaxAborted=e.result}return!0},_listen:function(){var self=this,$el=self.$element,$form=$el.closest("form"),$cont=self.$container;handler($el,"change",$.proxy(self._change,self)),handler(self.$btnFile,"click",$.proxy(self._browse,self)),handler($form,"reset",$.proxy(self.reset,self)),handler($cont.find(".fileinput-remove:not([disabled])"),"click",$.proxy(self.clear,self)),handler($cont.find(".fileinput-cancel"),"click",$.proxy(self.cancel,self)),self._initDragDrop(),self.isUploadable||handler($form,"submit",$.proxy(self._submitForm,self)),handler(self.$container.find(".fileinput-upload"),"click",$.proxy(self._uploadClick,self))},_initDragDrop:function(){var self=this,$zone=self.$dropZone;self.isUploadable&&self.dropZoneEnabled&&self.showPreview&&(handler($zone,"dragenter dragover",$.proxy(self._zoneDragEnter,self)),handler($zone,"dragleave",$.proxy(self._zoneDragLeave,self)),handler($zone,"drop",$.proxy(self._zoneDrop,self)),handler($(document),"dragenter dragover drop",self._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(e){var self=this,hasFiles=$.inArray("Files",e.originalEvent.dataTransfer.types)>-1;return self._zoneDragDropInit(e),self.isDisabled||!hasFiles?(e.originalEvent.dataTransfer.effectAllowed="none",void(e.originalEvent.dataTransfer.dropEffect="none")):void addCss(self.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){var self=this;self._zoneDragDropInit(e),self.isDisabled||self.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var self=this;e.preventDefault(),self.isDisabled||isEmpty(e.originalEvent.dataTransfer.files)||(self._change(e,"dragdrop"),self.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(e){var $form,self=this,$btn=self.$container.find(".fileinput-upload"),isEnabled=!$btn.hasClass("disabled")&&isEmpty($btn.attr("disabled"));if(!e||!e.isDefaultPrevented()){if(!self.isUploadable)return void(isEnabled&&"submit"!==$btn.attr("type")&&($form=$btn.closest("form"),$form.length&&$form.trigger("submit"),e.preventDefault()));e.preventDefault(),isEnabled&&self.upload()}},_submitForm:function(){var self=this,$el=self.$element,files=$el.get(0).files;return files&&self.minFileCount>0&&self._getFileCount(files.length)<self.minFileCount?(self._noFilesError({}),!1):!self._abort({})},_clearPreview:function(){var self=this,$thumbs=self.showUploadedThumbs?self.$preview.find(".file-preview-frame:not(.file-preview-success)"):self.$preview.find(".file-preview-frame");$thumbs.remove(),self.$preview.find(".file-preview-frame").length&&self.showPreview||self._resetUpload(),self._validateDefaultPreview()},_initPreview:function(isInit){var out,self=this,cap=self.initialCaption||"";return previewCache.count(self.id)?(out=previewCache.out(self.id),cap=isInit&&self.initialCaption?self.initialCaption:out.caption,self.$preview.html(out.content),self._setCaption(cap),void(isEmpty(out.content)||self.$container.removeClass("file-input-new"))):(self._clearPreview(),void(isInit?self._setCaption(cap):self._initCaption()))},_initPreviewDeletes:function(){var self=this,deleteExtraData=self.deleteExtraData||{},resetProgress=function(){var hasFiles=self.isUploadable?previewCache.count(self.id):self.$element.get(0).files.length;0!==self.$preview.find(".kv-file-remove").length||hasFiles||(self.reset(),self.initialCaption="")};self.$preview.find(".kv-file-remove").each(function(){var $el=$(this),vUrl=$el.data("url")||self.deleteUrl,vKey=$el.data("key");if(!isEmpty(vUrl)&&void 0!==vKey){var settings,params,config,extraData,$frame=$el.closest(".file-preview-frame"),cache=previewCache.data[self.id],index=$frame.data("fileindex");index=parseInt(index.replace("init_","")),config=isEmpty(cache.config)&&isEmpty(cache.config[index])?null:cache.config[index],extraData=isEmpty(config)||isEmpty(config.extra)?deleteExtraData:config.extra,"function"==typeof extraData&&(extraData=extraData()),params={id:$el.attr("id"),key:vKey,extra:extraData},settings=$.extend(!0,{},{url:vUrl,type:"POST",dataType:"json",data:$.extend(!0,{},{key:vKey},extraData),beforeSend:function(jqXHR){self.ajaxAborted=!1,self._raise("filepredelete",[vKey,jqXHR,extraData]),self.ajaxAborted?jqXHR.abort():(addCss($frame,"file-uploading"),addCss($el,"disabled"))},success:function(data,textStatus,jqXHR){var n,cap;return isEmpty(data)||isEmpty(data.error)?(previewCache.unset(self.id,index),n=previewCache.count(self.id),cap=n>0?self._getMsgSelected(n):"",self._raise("filedeleted",[vKey,jqXHR,extraData]),self._setCaption(cap),$frame.removeClass("file-uploading").addClass("file-deleted"),void $frame.fadeOut("slow",function(){self._clearObjects($frame),$frame.remove(),resetProgress(),n||0!==self.getFileStack().length||(self._setCaption(""),self.reset())})):(params.jqXHR=jqXHR,params.response=data,self._showError(data.error,params,"filedeleteerror"),$frame.removeClass("file-uploading"),$el.removeClass("disabled"),void resetProgress())},error:function(jqXHR,textStatus,errorThrown){var errMsg=self._parseError(jqXHR,errorThrown);params.jqXHR=jqXHR,params.response={},self._showError(errMsg,params,"filedeleteerror"),$frame.removeClass("file-uploading"),resetProgress()}},self.ajaxDeleteSettings),handler($el,"click",function(){return self._validateMinCount()?void $.ajax(settings):!1})}})},_clearObjects:function($el){$el.find("video audio").each(function(){this.pause(),$(this).remove()}),$el.find("img object div").each(function(){$(this).remove()})},_clearFileInput:function(){var $srcFrm,$tmpFrm,$tmpEl,self=this,$el=self.$element;isEmpty($el.val())||(self.isIE9||self.isIE10?($srcFrm=$el.closest("form"),$tmpFrm=$(document.createElement("form")),$tmpEl=$(document.createElement("div")),$el.before($tmpEl),$srcFrm.length?$srcFrm.after($tmpFrm):$tmpEl.after($tmpFrm),$tmpFrm.append($el).trigger("reset"),$tmpEl.before($el).remove(),$tmpFrm.remove()):$el.val(""),self.fileInputCleared=!0)},_resetUpload:function(){var self=this;self.uploadCache={content:[],config:[],tags:[],append:!0},self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.uploadAsyncCount=0,self.loadedImages=[],self.totalImagesCount=0,self.$btnUpload.removeAttr("disabled"),self._setProgress(0),addCss(self.$progress,"hide"),self._resetErrors(!1),self.ajaxAborted=!1,self.ajaxRequests=[],self._resetCanvas()},_resetCanvas:function(){var self=this;self.canvas&&self.imageCanvasContext&&self.imageCanvasContext.clearRect(0,0,self.canvas.width,self.canvas.height)},_hasInitialPreview:function(){var self=this;return!self.overwriteInitial&&previewCache.count(self.id)},_resetPreview:function(){var out,cap,self=this;previewCache.count(self.id)?(out=previewCache.out(self.id),self.$preview.html(out.content),cap=self.initialCaption?self.initialCaption:out.caption,self._setCaption(cap)):(self._clearPreview(),self._initCaption())},_clearDefaultPreview:function(){var self=this;self.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var self=this;self.showPreview&&!isEmpty(self.defaultPreviewContent)&&(self.$preview.html('<div class="file-default-preview">'+self.defaultPreviewContent+"</div>"),self.$container.removeClass("file-input-new"))},_resetPreviewThumbs:function(isAjax){var out,self=this;return isAjax?(self._clearPreview(),void self.clearStack()):void(self._hasInitialPreview()?(out=previewCache.out(self.id),self.$preview.html(out.content),self._setCaption(out.caption),self._initPreviewDeletes()):self._clearPreview())},_getLayoutTemplate:function(t){var self=this,template=isSet(t,self.layoutTemplates)?self.layoutTemplates[t]:defaultLayoutTemplates[t];return isEmpty(self.customLayoutTags)?template:replaceTags(template,self.customLayoutTags)},_getPreviewTemplate:function(t){var self=this,template=isSet(t,self.previewTemplates)?self.previewTemplates[t]:defaultPreviewTemplates[t];return isEmpty(self.customPreviewTags)?template:replaceTags(template,self.customPreviewTags)},_getOutData:function(jqXHR,responseData,filesData){var self=this;return jqXHR=jqXHR||{},responseData=responseData||{},filesData=filesData||self.filestack.slice(0)||{},{form:self.formdata,files:filesData,filenames:self.filenames,extra:self._getExtraData(),response:responseData,reader:self.reader,jqXHR:jqXHR}},_getMsgSelected:function(n){var self=this,strFiles=1===n?self.fileSingle:self.filePlural;return self.msgSelected.replace("{n}",n).replace("{files}",strFiles)},_getThumbs:function(css){return css=css||"",this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+css)},_getExtraData:function(previewId,index){var self=this,data=self.uploadExtraData;return"function"==typeof self.uploadExtraData&&(data=self.uploadExtraData(previewId,index)),
data},_initXhr:function(xhrobj,previewId,fileCount){var self=this;return xhrobj.upload&&xhrobj.upload.addEventListener("progress",function(event){var pct=0,position=event.loaded||event.position,total=event.total;event.lengthComputable&&(pct=Math.ceil(position/total*100)),previewId?self._setAsyncUploadStatus(previewId,pct,fileCount):self._setProgress(Math.ceil(pct))},!1),xhrobj},_ajaxSubmit:function(fnBefore,fnSuccess,fnComplete,fnError,previewId,index){var settings,self=this;self._raise("filepreajax",[previewId,index]),self._uploadExtra(previewId,index),settings=$.extend(!0,{},{xhr:function(){var xhrobj=$.ajaxSettings.xhr();return self._initXhr(xhrobj,previewId,self.getFileStack().length)},url:self.uploadUrl,type:"POST",dataType:"json",data:self.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:fnBefore,success:fnSuccess,complete:fnComplete,error:fnError},self.ajaxSettings),self.ajaxRequests.push($.ajax(settings))},_initUploadSuccess:function(out,$thumb,allFiles){var append,data,index,$newThumb,content,config,tags,i,self=this;self.showPreview&&"object"==typeof out&&!$.isEmptyObject(out)&&void 0!==out.initialPreview&&out.initialPreview.length>0&&(self.hasInitData=!0,content=out.initialPreview||[],config=out.initialPreviewConfig||[],tags=out.initialPreviewThumbTags||[],append=void 0===out.append||out.append?!0:!1,self.overwriteInitial=!1,void 0!==$thumb?allFiles?(i=$thumb.attr("data-fileindex"),self.uploadCache.content[i]=content[0],self.uploadCache.config[i]=config[0],self.uploadCache.tags[i]=tags[0],self.uploadCache.append=append):(index=previewCache.add(self.id,content,config[0],tags[0],append),data=previewCache.get(self.id,index,!1),$newThumb=$(data).hide(),$thumb.after($newThumb).fadeOut("slow",function(){$newThumb.fadeIn("slow").css("display:inline-block"),self._initPreviewDeletes(),self._clearFileInput(),$thumb.remove()})):(previewCache.set(self.id,content,config,tags,append),self._initPreview(),self._initPreviewDeletes()))},_initSuccessThumbs:function(){var self=this;self.showPreview&&self._getThumbs(".file-preview-success").each(function(){var $thumb=$(this),$remove=$thumb.find(".kv-file-remove");$remove.removeAttr("disabled"),handler($remove,"click",function(){var out=self._raise("filesuccessremove",[$thumb.attr("id"),$thumb.data("fileindex")]);cleanMemory($thumb),out!==!1&&$thumb.fadeOut("slow",function(){$thumb.remove(),self.$preview.find(".file-preview-frame").length||self.reset()})})})},_checkAsyncComplete:function(){var previewId,i,self=this;for(i=0;i<self.filestack.length;i++)if(self.filestack[i]&&(previewId=self.previewInitId+"-"+i,-1===$.inArray(previewId,self.uploadLog)))return!1;return self.uploadAsyncCount===self.uploadLog.length},_uploadExtra:function(previewId,index){var self=this,data=self._getExtraData(previewId,index);0!==data.length&&$.each(data,function(key,value){self.formdata.append(key,value)})},_uploadSingle:function(i,files,allFiles){var outData,$thumb,chkComplete,$btnUpload,$btnDelete,fnBefore,fnSuccess,fnComplete,fnError,updateUploadLog,self=this,total=self.getFileStack().length,formdata=new FormData,previewId=self.previewInitId+"-"+i,hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData),params={id:previewId,index:i};self.formdata=formdata,self.showPreview&&($thumb=$("#"+previewId+":not(.file-preview-initial)"),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove"),$("#"+previewId).find(".file-thumb-progress").removeClass("hide")),0===total||!hasPostData||$btnUpload&&$btnUpload.hasClass("disabled")||self._abort(params)||(updateUploadLog=function(i,previewId){self.updateStack(i,void 0),self.uploadLog.push(previewId),self._checkAsyncComplete()&&(self.fileBatchCompleted=!0)},chkComplete=function(){self.fileBatchCompleted&&setTimeout(function(){self.showPreview&&(previewCache.set(self.id,self.uploadCache.content,self.uploadCache.config,self.uploadCache.tags,self.uploadCache.append),self.hasInitData&&(self._initPreview(),self._initPreviewDeletes())),self.unlock(),self._clearFileInput(),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()]),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self._setProgress(100)},100)},fnBefore=function(jqXHR){outData=self._getOutData(jqXHR),self.fileBatchCompleted=!1,self.showPreview&&($thumb.hasClass("file-preview-success")||(self._setThumbStatus($thumb,"Loading"),addCss($thumb,"file-uploading")),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0)),allFiles||self.lock(),self._raise("filepreupload",[outData,previewId,i]),$.extend(!0,params,outData),self._abort(params)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){outData=self._getOutData(jqXHR,data),$.extend(!0,params,outData),setTimeout(function(){isEmpty(data)||isEmpty(data.error)?(self.showPreview&&(self._setThumbStatus($thumb,"Success"),$btnUpload.hide(),self._initUploadSuccess(data,$thumb,allFiles)),self._raise("fileuploaded",[outData,previewId,i]),allFiles?updateUploadLog(i,previewId):self.updateStack(i,void 0)):(self._showUploadError(data.error,params),self._setPreviewError($thumb,i),allFiles&&updateUploadLog(i,previewId))},100)},fnComplete=function(){setTimeout(function(){self.showPreview&&($btnUpload.removeAttr("disabled"),$btnDelete.removeAttr("disabled"),$thumb.removeClass("file-uploading")),allFiles?chkComplete():(self.unlock(!1),self._clearFileInput()),self._initSuccessThumbs()},100)},fnError=function(jqXHR,textStatus,errorThrown){var errMsg=self._parseError(jqXHR,errorThrown,allFiles?files[i].name:null);setTimeout(function(){allFiles&&updateUploadLog(i,previewId),self.uploadStatus[previewId]=100,self._setPreviewError($thumb,i),$.extend(!0,params,self._getOutData(jqXHR)),self._showUploadError(errMsg,params)},100)},formdata.append(self.uploadFileAttr,files[i],self.filenames[i]),formdata.append("file_id",i),self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError,previewId,i))},_uploadBatch:function(){var fnBefore,fnSuccess,fnError,fnComplete,setAllUploaded,self=this,files=self.filestack,total=files.length,params={},hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData);self.formdata=new FormData,0!==total&&hasPostData&&!self._abort(params)&&(setAllUploaded=function(){$.each(files,function(key){self.updateStack(key,void 0)}),self._clearFileInput()},fnBefore=function(jqXHR){self.lock();var outData=self._getOutData(jqXHR);self.showPreview&&self._getThumbs().each(function(){var $thumb=$(this),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove");$thumb.hasClass("file-preview-success")||(self._setThumbStatus($thumb,"Loading"),addCss($thumb,"file-uploading")),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0)}),self._raise("filebatchpreupload",[outData]),self._abort(outData)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var outData=self._getOutData(jqXHR,data),$thumbs=self._getThumbs(),key=0,keys=isEmpty(data)||isEmpty(data.errorkeys)?[]:data.errorkeys;isEmpty(data)||isEmpty(data.error)?(self._raise("filebatchuploadsuccess",[outData]),setAllUploaded(),self.showPreview?($thumbs.each(function(){var $thumb=$(this),$btnUpload=$thumb.find(".kv-file-upload");$thumb.find(".kv-file-upload").hide(),self._setThumbStatus($thumb,"Success"),$thumb.removeClass("file-uploading"),$btnUpload.removeAttr("disabled")}),self._initUploadSuccess(data)):self.reset()):(self.showPreview&&($thumbs.each(function(){var $thumb=$(this),$btnDelete=$thumb.find(".kv-file-remove"),$btnUpload=$thumb.find(".kv-file-upload");return $thumb.removeClass("file-uploading"),$btnUpload.removeAttr("disabled"),$btnDelete.removeAttr("disabled"),0===keys.length?void self._setPreviewError($thumb):(-1!==$.inArray(key,keys)?self._setPreviewError($thumb):($thumb.find(".kv-file-upload").hide(),self._setThumbStatus($thumb,"Success"),self.updateStack(key,void 0)),void key++)}),self._initUploadSuccess(data)),self._showUploadError(data.error,outData,"filebatchuploaderror"))},fnComplete=function(){self._setProgress(100),self.unlock(),self._initSuccessThumbs(),self._clearFileInput(),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()])},fnError=function(jqXHR,textStatus,errorThrown){var outData=self._getOutData(jqXHR),errMsg=self._parseError(jqXHR,errorThrown);self._showUploadError(errMsg,outData,"filebatchuploaderror"),self.uploadFileCount=total-1,self.showPreview&&(self._getThumbs().each(function(){var $thumb=$(this),key=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[key]&&self._setPreviewError($thumb)}),self._getThumbs().removeClass("file-uploading"),self._getThumbs(" .kv-file-upload").removeAttr("disabled"),self._getThumbs(" .kv-file-delete").removeAttr("disabled"))},$.each(files,function(key,data){isEmpty(files[key])||self.formdata.append(self.uploadFileAttr,data,self.filenames[key])}),self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},_uploadExtraOnly:function(){var fnBefore,fnSuccess,fnComplete,fnError,self=this,params={};self.formdata=new FormData,self._abort(params)||(fnBefore=function(jqXHR){self.lock();var outData=self._getOutData(jqXHR);self._raise("filebatchpreupload",[outData]),self._setProgress(50),params.data=outData,params.xhr=jqXHR,self._abort(params)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var outData=self._getOutData(jqXHR,data);isEmpty(data)||isEmpty(data.error)?(self._raise("filebatchuploadsuccess",[outData]),self._clearFileInput(),self._initUploadSuccess(data)):self._showUploadError(data.error,outData,"filebatchuploaderror")},fnComplete=function(){self._setProgress(100),self.unlock(),self._clearFileInput(),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()])},fnError=function(jqXHR,textStatus,errorThrown){var outData=self._getOutData(jqXHR),errMsg=self._parseError(jqXHR,errorThrown);params.data=outData,self._showUploadError(errMsg,outData,"filebatchuploaderror")},self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},_initFileActions:function(){var self=this;self.showPreview&&(self.$preview.find(".kv-file-remove").each(function(){var hasError,n,cap,status,$el=$(this),$frame=$el.closest(".file-preview-frame"),id=$frame.attr("id"),ind=$frame.attr("data-fileindex");handler($el,"click",function(){return status=self._raise("filepreremove",[id,ind]),status!==!1&&self._validateMinCount()?(hasError=$frame.hasClass("file-preview-error"),cleanMemory($frame),void $frame.fadeOut("slow",function(){self.updateStack(ind,void 0),self._clearObjects($frame),$frame.remove(),id&&hasError&&self.$errorContainer.find('li[data-file-id="'+id+'"]').fadeOut("fast",function(){$(this).remove(),self._errorsExist()||self._resetErrors()});var filestack=self.getFileStack(!0),len=filestack.length,chk=previewCache.count(self.id),hasThumb=self.showPreview&&self.$preview.find(".file-preview-frame").length;self._clearFileInput(),0!==len||0!==chk||hasThumb?(n=chk+len,cap=n>1?self._getMsgSelected(n):filestack[0]?self._getFileNames()[0]:"",self._setCaption(cap)):self.reset(),self._raise("fileremoved",[id,ind])})):!1})}),self.$preview.find(".kv-file-upload").each(function(){var $el=$(this);handler($el,"click",function(){var $frame=$el.closest(".file-preview-frame"),ind=$frame.attr("data-fileindex");$frame.hasClass("file-preview-error")||self._uploadSingle(ind,self.filestack,!1)})}))},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_previewDefault:function(file,previewId,isDisabled){if(this.showPreview){var self=this,frameClass="",fname=file?file.name:"",data=objUrl.createObjectURL(file),ind=previewId.slice(previewId.lastIndexOf("-")+1),config=self.previewSettings.other||defaultPreviewSettings.other,footer=self._renderFileFooter(file.name,config.width),previewOtherTemplate=self._parseFilePreviewIcon(self._getPreviewTemplate("other"),fname);isDisabled===!0&&(self.isUploadable||(footer+='<div class="file-other-error" title="'+self.fileActionSettings.indicatorErrorTitle+'">'+self.fileActionSettings.indicatorError+"</div>")),self._clearDefaultPreview(),self.$preview.append("\n"+previewOtherTemplate.replace(/\{previewId}/g,previewId).replace(/\{frameClass}/g,frameClass).replace(/\{fileindex}/g,ind).replace(/\{caption}/g,self.slug(file.name)).replace(/\{width}/g,config.width).replace(/\{height}/g,config.height).replace(/\{type}/g,file.type).replace(/\{data}/g,data).replace(/\{footer}/g,footer)),isDisabled===!0&&self.isUploadable&&self._setThumbStatus($("#"+previewId),"Error")}},_previewFile:function(i,file,theFile,previewId,data){if(this.showPreview){var content,strText,id,self=this,cat=self._parseFileType(file),fname=file?file.name:"",caption=self.slug(fname),types=self.allowedPreviewTypes,mimes=self.allowedPreviewMimeTypes,tmplt=self._getPreviewTemplate(cat),chkTypes=types&&types.indexOf(cat)>=0,config=isSet(cat,self.previewSettings)?self.previewSettings[cat]:defaultPreviewSettings[cat],chkMimes=mimes&&-1!==mimes.indexOf(file.type),footer=self._renderFileFooter(caption,config.width),modal="",ind=previewId.slice(previewId.lastIndexOf("-")+1);chkTypes||chkMimes?(tmplt=self._parseFilePreviewIcon(tmplt,fname.split(".").pop()),"text"===cat?(strText=htmlEncode(theFile.target.result),id="text-"+uniqId(),content=tmplt.replace(/\{zoom}/g,self._getLayoutTemplate("zoom")),modal=self._getLayoutTemplate("modal").replace("{id}",id).replace(/\{title}/g,caption).replace(/\{body}/g,strText).replace(/\{heading}/g,self.msgZoomModalHeading),content=content.replace(/\{previewId}/g,previewId).replace(/\{caption}/g,caption).replace(/\{width}/g,config.width).replace(/\{height}/g,config.height).replace(/\{frameClass}/g,"").replace(/\{zoomInd}/g,self.zoomIndicator).replace(/\{footer}/g,footer).replace(/\{fileindex}/g,ind).replace(/\{type}/g,file.type).replace(/\{zoomTitle}/g,self.msgZoomTitle).replace(/\{dialog}/g,"$('#"+id+"').modal('show')").replace(/\{data}/g,strText)+modal):content=tmplt.replace(/\{previewId}/g,previewId).replace(/\{caption}/g,caption).replace(/\{frameClass}/g,"").replace(/\{type}/g,file.type).replace(/\{fileindex}/g,ind).replace(/\{width}/g,config.width).replace(/\{height}/g,config.height).replace(/\{footer}/g,footer).replace(/\{data}/g,data),self._clearDefaultPreview(),self.$preview.append("\n"+content),self._validateImage(i,previewId,caption,file.type)):self._previewDefault(file,previewId)}},_slugDefault:function(text){return isEmpty(text)?"":String(text).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(files){this.reader=new FileReader;var readFile,self=this,$el=self.$element,$preview=self.$preview,reader=self.reader,$container=self.$previewContainer,$status=self.$previewStatus,msgLoading=self.msgLoading,msgProgress=self.msgProgress,previewInitId=self.previewInitId,numFiles=files.length,settings=self.fileTypeSettings,ctr=self.filestack.length,throwError=function(msg,file,previewId,index){var p1=$.extend(!0,{},self._getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self._previewDefault(file,previewId,!0),self.isUploadable&&self.addToStack(void 0),setTimeout(readFile(index+1),100),self._initFileActions(),self.removeFromPreviewOnError&&$("#"+previewId).remove(),self.isUploadable?self._showUploadError(msg,p1):self._showError(msg,p2)};self.loadedImages=[],self.totalImagesCount=0,$.each(files,function(key,file){var func=self.fileTypeSettings.image||defaultFileTypeSettings.image;func&&func(file.type)&&self.totalImagesCount++}),readFile=function(i){if(isEmpty($el.attr("multiple"))&&(numFiles=1),i>=numFiles)return self.isUploadable&&self.filestack.length>0?self._raise("filebatchselected",[self.getFileStack()]):self._raise("filebatchselected",[files]),$container.removeClass("file-thumb-loading"),void $status.html("");var isText,checkFile,j,msg,typ,chk,node=ctr+i,previewId=previewInitId+"-"+node,file=files[i],caption=self.slug(file.name),fileSize=(file.size||0)/1e3,fileExtExpr="",previewData=objUrl.createObjectURL(file),fileCount=0,fileTypes=self.allowedFileTypes,strTypes=isEmpty(fileTypes)?"":fileTypes.join(", "),fileExt=self.allowedFileExtensions,strExt=isEmpty(fileExt)?"":fileExt.join(", ");if(isEmpty(fileExt)||(fileExtExpr=new RegExp("\\.("+fileExt.join("|")+")$","i")),fileSize=fileSize.toFixed(2),self.maxFileSize>0&&fileSize>self.maxFileSize)return msg=self.msgSizeTooLarge.replace("{name}",caption).replace("{size}",fileSize).replace("{maxSize}",self.maxFileSize),void(self.isError=throwError(msg,file,previewId,i));if(!isEmpty(fileTypes)&&isArray(fileTypes)){for(j=0;j<fileTypes.length;j+=1)typ=fileTypes[j],checkFile=settings[typ],chk=void 0!==checkFile&&checkFile(file.type,caption),fileCount+=isEmpty(chk)?0:chk.length;if(0===fileCount)return msg=self.msgInvalidFileType.replace("{name}",caption).replace("{types}",strTypes),void(self.isError=throwError(msg,file,previewId,i))}return 0!==fileCount||isEmpty(fileExt)||!isArray(fileExt)||isEmpty(fileExtExpr)||(chk=compare(caption,fileExtExpr),fileCount+=isEmpty(chk)?0:chk.length,0!==fileCount)?self.showPreview?($preview.length>0&&void 0!==FileReader?($status.html(msgLoading.replace("{index}",i+1).replace("{files}",numFiles)),$container.addClass("file-thumb-loading"),reader.onerror=function(evt){self._errorHandler(evt,caption)},reader.onload=function(theFile){self._previewFile(i,file,theFile,previewId,previewData),self._initFileActions()},reader.onloadend=function(){msg=msgProgress.replace("{index}",i+1).replace("{files}",numFiles).replace("{percent}",50).replace("{name}",caption),setTimeout(function(){$status.html(msg),self._updateFileDetails(numFiles),readFile(i+1)},100),self._raise("fileloaded",[file,previewId,i,reader])},reader.onprogress=function(data){if(data.lengthComputable){var fact=data.loaded/data.total*100,progress=Math.ceil(fact);msg=msgProgress.replace("{index}",i+1).replace("{files}",numFiles).replace("{percent}",progress).replace("{name}",caption),setTimeout(function(){$status.html(msg)},100)}},isText=isSet("text",settings)?settings.text:defaultFileTypeSettings.text,isText(file.type,caption)?reader.readAsText(file,self.textEncoding):reader.readAsArrayBuffer(file)):(self._previewDefault(file,previewId),setTimeout(function(){readFile(i+1),self._updateFileDetails(numFiles)},100),self._raise("fileloaded",[file,previewId,i,reader])),void self.addToStack(file)):(self.addToStack(file),setTimeout(readFile(i+1),100),void self._raise("fileloaded",[file,previewId,i,reader])):(msg=self.msgInvalidFileExtension.replace("{name}",caption).replace("{extensions}",strExt),void(self.isError=throwError(msg,file,previewId,i)))},readFile(0),self._updateFileDetails(numFiles,!1)},_updateFileDetails:function(numFiles){var self=this,$el=self.$element,fileStack=self.getFileStack(),name=$el[0].files[0]&&$el[0].files[0].name||fileStack.length&&fileStack[0].name||"",label=self.slug(name),n=self.isUploadable?fileStack.length:numFiles,nFiles=previewCache.count(self.id)+n,log=n>1?self._getMsgSelected(nFiles):label;self.isError?(self.$previewContainer.removeClass("file-thumb-loading"),self.$previewStatus.html(""),self.$captionContainer.find(".kv-caption-icon").hide()):self._showFileIcon(),self._setCaption(log,self.isError),self.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&self._raise("fileselect",[numFiles,label]),previewCache.count(self.id)&&self._initPreviewDeletes()},_setThumbStatus:function($thumb,status){var self=this;if(self.showPreview){var icon="indicator"+status,msg=icon+"Title",css="file-preview-"+status.toLowerCase(),$indicator=$thumb.find(".file-upload-indicator"),config=self.fileActionSettings;$thumb.removeClass("file-preview-success file-preview-error file-preview-loading"),"Error"===status&&$thumb.find(".kv-file-upload").attr("disabled",!0),$indicator.html(config[icon]),$indicator.attr("title",config[msg]),$thumb.addClass(css)}},_setProgressCancelled:function(){var self=this;self._setProgress(100,self.$progress,self.msgCancelled)},_setProgress:function(p,$el,error){var self=this,pct=Math.min(p,100),template=100>pct?self.progressTemplate:error?self.progressErrorTemplate:self.progressCompleteTemplate;$el=$el||self.$progress,isEmpty(template)||($el.html(template.replace(/\{percent}/g,pct)),error&&$el.find('[role="progressbar"]').html(error))},_setFileDropZoneTitle:function(){var self=this,$zone=self.$container.find(".file-drop-zone");$zone.find("."+self.dropZoneTitleClass).remove(),self.isUploadable&&self.showPreview&&0!==$zone.length&&!(self.getFileStack().length>0)&&self.dropZoneEnabled&&(0===$zone.find(".file-preview-frame").length&&isEmpty(self.defaultPreviewContent)&&$zone.prepend('<div class="'+self.dropZoneTitleClass+'">'+self.dropZoneTitle+"</div>"),self.$container.removeClass("file-input-new"),addCss(self.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(previewId,pct,total){var self=this,sum=0;self._setProgress(pct,$("#"+previewId).find(".file-thumb-progress")),self.uploadStatus[previewId]=pct,$.each(self.uploadStatus,function(key,value){sum+=value}),self._setProgress(Math.ceil(sum/total))},_validateMinCount:function(){var self=this,len=self.isUploadable?self.getFileStack().length:self.$element.get(0).files.length;return self.validateInitialCount&&self.minFileCount>0&&self._getFileCount(len-1)<self.minFileCount?(self._noFilesError({}),!1):!0},_getFileCount:function(fileCount){var self=this,addCount=0;return self.validateInitialCount&&!self.overwriteInitial&&(addCount=previewCache.count(self.id),fileCount+=addCount),fileCount},_getFileName:function(file){return file&&file.name?this.slug(file.name):void 0},_getFileNames:function(skipNull){var self=this;return self.filenames.filter(function(n){return skipNull?void 0!==n:void 0!==n&&null!==n})},_setPreviewError:function($thumb,i,val){var self=this;i&&self.updateStack(i,val),self.removeFromPreviewOnError?$thumb.remove():self._setThumbStatus($thumb,"Error")},_checkDimensions:function(i,chk,$img,$thumb,fname,type,params){var msg,dim,$imgEl,isValid,self=this,tag="Small"===chk?"min":"max",limit=self[tag+"Image"+type];!isEmpty(limit)&&$img.length&&($imgEl=$img[0],dim="Width"===type?$imgEl.naturalWidth||$imgEl.width:$imgEl.naturalHeight||$imgEl.height,isValid="Small"===chk?dim>=limit:limit>=dim,isValid||(msg=self["msgImage"+type+chk].replace("{name}",fname).replace("{size}",limit),self._showUploadError(msg,params),self._setPreviewError($thumb,i,null)))},_validateImage:function(i,previewId,fname,ftype){var params,w1,w2,self=this,$preview=self.$preview,$thumb=$preview.find("#"+previewId),$img=$thumb.find("img");fname=fname||"Untitled",$img.length&&handler($img,"load",function(){w1=$thumb.width(),w2=$preview.width(),w1>w2&&($img.css("width","100%"),$thumb.css("width","97%")),params={ind:i,id:previewId},self._checkDimensions(i,"Small",$img,$thumb,fname,"Width",params),self._checkDimensions(i,"Small",$img,$thumb,fname,"Height",params),self.resizeImage||(self._checkDimensions(i,"Large",$img,$thumb,fname,"Width",params),self._checkDimensions(i,"Large",$img,$thumb,fname,"Height",params)),self._raise("fileimageloaded",[previewId]),self.loadedImages.push({ind:i,img:$img,thumb:$thumb,pid:previewId,typ:ftype}),self._validateAllImages(),objUrl.revokeObjectURL($img.attr("src"))})},_validateAllImages:function(){var i,config,$img,$thumb,pid,ind,errFunc,self=this,params={};if(self.loadedImages.length===self.totalImagesCount&&(self._raise("fileimagesloaded"),self.resizeImage)){for(errFunc=self.isUploadable?self._showUploadError:self._showError,i=0;i<self.loadedImages.length;i++)config=self.loadedImages[i],$img=config.img,$thumb=config.thumb,pid=config.pid,ind=config.ind,params={id:pid,index:ind},self._getResizedImage($img[0],config.typ,pid,ind)||(errFunc(self.msgImageResizeError,params,"fileimageresizeerror"),self._setPreviewError($thumb,ind));self._raise("fileimagesresized")}},_getResizedImage:function(image,type,pid,ind){var chkWidth,chkHeight,self=this,width=image.naturalWidth,height=image.naturalHeight,ratio=1,maxWidth=self.maxImageWidth||width,maxHeight=self.maxImageHeight||height,isValidImage=width&&height,canvas=self.imageCanvas,context=self.imageCanvasContext;if(!isValidImage)return!1;if(width===maxWidth&&height===maxHeight)return!0;type=type||self.resizeDefaultImageType,chkWidth=width>maxWidth,chkHeight=height>maxHeight,ratio="width"===self.resizePreference?chkWidth?maxWidth/width:chkHeight?maxHeight/height:1:chkHeight?maxHeight/height:chkWidth?maxWidth/width:1,self._resetCanvas(),width*=ratio,height*=ratio,canvas.width=width,canvas.height=height;try{return context.drawImage(image,0,0,width,height),canvas.toBlob(function(blob){self._raise("fileimageresized",[pid,ind]),self.filestack[ind]=blob},type,self.resizeQuality),!0}catch(err){return!1}},_initBrowse:function($container){var self=this;self.$btnFile=$container.find(".btn-file"),self.$btnFile.append(self.$element)},_initCaption:function(){var self=this,cap=self.initialCaption||"";return self.overwriteInitial||isEmpty(cap)?(self.$caption.html(""),!1):(self._setCaption(cap),!0)},_setCaption:function(content,isError){var title,out,n,cap,self=this,stack=self.getFileStack();if(self.$caption.length){if(isError)title=$("<div>"+self.msgValidationError+"</div>").text(),n=stack.length,cap=n?1===n&&stack[0]?self._getFileNames()[0]:self._getMsgSelected(n):self._getMsgSelected(self.msgNo),out='<span class="'+self.msgValidationErrorClass+'">'+self.msgValidationErrorIcon+(isEmpty(content)?cap:content)+"</span>";else{if(isEmpty(content))return;title=$("<div>"+content+"</div>").text(),out=self._getLayoutTemplate("icon")+title}self.$caption.html(out),self.$caption.attr("title",title),self.$captionContainer.find(".file-caption-ellipsis").attr("title",title)}},_createContainer:function(){var self=this,$container=$(document.createElement("div")).attr({"class":"file-input file-input-new"}).html(self._renderMain());return self.$element.before($container),self._initBrowse($container),$container},_refreshContainer:function(){var self=this,$container=self.$container;$container.before(self.$element),$container.html(self._renderMain()),self._initBrowse($container)},_renderMain:function(){var self=this,dropCss=self.isUploadable&&self.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",close=self.showClose?self._getLayoutTemplate("close"):"",preview=self.showPreview?self._getLayoutTemplate("preview").replace(/\{class}/g,self.previewClass).replace(/\{dropClass}/g,dropCss):"",css=self.isDisabled?self.captionClass+" file-caption-disabled":self.captionClass,caption=self.captionTemplate.replace(/\{class}/g,css+" kv-fileinput-caption");return self.mainTemplate.replace(/\{class}/g,self.mainClass).replace(/\{preview}/g,preview).replace(/\{close}/g,close).replace(/\{caption}/g,caption).replace(/\{upload}/g,self._renderButton("upload")).replace(/\{remove}/g,self._renderButton("remove")).replace(/\{cancel}/g,self._renderButton("cancel")).replace(/\{browse}/g,self._renderButton("browse"))},_renderButton:function(type){var self=this,tmplt=self._getLayoutTemplate("btnDefault"),css=self[type+"Class"],title=self[type+"Title"],icon=self[type+"Icon"],label=self[type+"Label"],status=self.isDisabled?" disabled":"",btnType="button";switch(type){case"remove":if(!self.showRemove)return"";break;case"cancel":if(!self.showCancel)return"";css+=" hide";break;case"upload":if(!self.showUpload)return"";self.isUploadable&&!self.isDisabled?tmplt=self._getLayoutTemplate("btnLink").replace("{href}",self.uploadUrl):btnType="submit";break;case"browse":tmplt=self._getLayoutTemplate("btnBrowse");break;default:return""}return css+="browse"===type?" btn-file":" fileinput-"+type+" fileinput-"+type+"-button",isEmpty(label)||(label=' <span class="'+self.buttonLabelClass+'">'+label+"</span>"),tmplt.replace("{type}",btnType).replace("{css}",css).replace("{title}",title).replace("{status}",status).replace("{icon}",icon).replace("{label}",label)},_renderThumbProgress:function(){return'<div class="file-thumb-progress hide">'+this.progressTemplate.replace(/\{percent}/g,"0")+"</div>"},_renderFileFooter:function(caption,width){var footer,out,self=this,config=self.fileActionSettings,template=self._getLayoutTemplate("footer");return self.isUploadable?(footer=template.replace(/\{actions}/g,self._renderFileActions(!0,!0,!1,!1,!1)),out=footer.replace(/\{caption}/g,caption).replace(/\{width}/g,width).replace(/\{progress}/g,self._renderThumbProgress()).replace(/\{indicator}/g,config.indicatorNew).replace(/\{indicatorTitle}/g,config.indicatorNewTitle)):out=template.replace(/\{actions}/g,"").replace(/\{caption}/g,caption).replace(/\{progress}/g,"").replace(/\{width}/g,width).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,""),out=replaceTags(out,self.previewThumbTags)},_renderFileActions:function(showUpload,showDelete,disabled,url,key){if(!showUpload&&!showDelete)return"";var self=this,vUrl=url===!1?"":' data-url="'+url+'"',vKey=key===!1?"":' data-key="'+key+'"',btnDelete=self._getLayoutTemplate("actionDelete"),btnUpload="",template=self._getLayoutTemplate("actions"),otherButtons=self.otherActionButtons.replace(/\{dataKey}/g,vKey),config=self.fileActionSettings,removeClass=disabled?config.removeClass+" disabled":config.removeClass;return btnDelete=btnDelete.replace(/\{removeClass}/g,removeClass).replace(/\{removeIcon}/g,config.removeIcon).replace(/\{removeTitle}/g,config.removeTitle).replace(/\{dataUrl}/g,vUrl).replace(/\{dataKey}/g,vKey),showUpload&&(btnUpload=self._getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,config.uploadClass).replace(/\{uploadIcon}/g,config.uploadIcon).replace(/\{uploadTitle}/g,config.uploadTitle)),template.replace(/\{delete}/g,btnDelete).replace(/\{upload}/g,btnUpload).replace(/\{other}/g,otherButtons)},_browse:function(e){var self=this;self._raise("filebrowse"),e&&e.isDefaultPrevented()||(self.isError&&!self.isUploadable&&self.clear(),self.$captionContainer.focus())},_change:function(e){var self=this,$el=self.$element;if(!self.isUploadable&&isEmpty($el.val())&&self.fileInputCleared)return void(self.fileInputCleared=!1);self.fileInputCleared=!1;var tfiles,msg,total,f,n,len,isDragDrop=arguments.length>1,isAjaxUpload=self.isUploadable,i=0,files=isDragDrop?e.originalEvent.dataTransfer.files:$el.get(0).files,ctr=self.filestack.length,isSingleUpload=isEmpty($el.attr("multiple")),flagSingle=isSingleUpload&&ctr>0,folders=0,throwError=function(mesg,file,previewId,index){var p1=$.extend(!0,{},self._getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self.isUploadable?self._showUploadError(mesg,p1):self._showError(mesg,p2)};if(self.reader=null,self._resetUpload(),self._hideFileIcon(),self.isUploadable&&self.$container.find(".file-drop-zone ."+self.dropZoneTitleClass).remove(),isDragDrop)for(tfiles=[];files[i];)f=files[i],f.type||f.size%4096!==0?tfiles.push(f):folders++,i++;else tfiles=void 0===e.target.files?e.target&&e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files;if(isEmpty(tfiles)||0===tfiles.length)return isAjaxUpload||self.clear(),self._showFolderError(folders),void self._raise("fileselectnone");if(self._resetErrors(),len=tfiles.length,total=self._getFileCount(self.isUploadable?self.getFileStack().length+len:len),self.maxFileCount>0&&total>self.maxFileCount){if(!self.autoReplace||len>self.maxFileCount)return n=self.autoReplace&&len>self.maxFileCount?len:total,msg=self.msgFilesTooMany.replace("{m}",self.maxFileCount).replace("{n}",n),self.isError=throwError(msg,null,null,null),self.$captionContainer.find(".kv-caption-icon").hide(),self._setCaption("",!0),void self.$container.removeClass("file-input-new file-input-ajax-new");total>self.maxFileCount&&self._resetPreviewThumbs(isAjaxUpload)}else!isAjaxUpload||flagSingle?(self._resetPreviewThumbs(!1),flagSingle&&self.clearStack()):!isAjaxUpload||0!==ctr||previewCache.count(self.id)&&!self.overwriteInitial||self._resetPreviewThumbs(!0);
self.isPreviewable?self._readFiles(tfiles):self._updateFileDetails(1),self._showFolderError(folders)},_abort:function(params){var data,self=this;return self.ajaxAborted&&"object"==typeof self.ajaxAborted&&void 0!==self.ajaxAborted.message?(data=$.extend(!0,{},self._getOutData(),params),data.abortData=self.ajaxAborted.data||{},data.abortMessage=self.ajaxAborted.message,self.cancel(),self._setProgress(100,self.$progress,self.msgCancelled),self._showUploadError(self.ajaxAborted.message,data,"filecustomerror"),!0):!1},_resetFileStack:function(){var self=this,i=0,newstack=[],newnames=[];self._getThumbs().each(function(){var $thumb=$(this),ind=$thumb.attr("data-fileindex"),file=self.filestack[ind];-1!==ind&&(void 0!==file?(newstack[i]=file,newnames[i]=self._getFileName(file),$thumb.attr({id:self.previewInitId+"-"+i,"data-fileindex":i}),i++):$thumb.attr({id:"uploaded-"+uniqId(),"data-fileindex":"-1"}))}),self.filestack=newstack,self.filenames=newnames},clearStack:function(){var self=this;return self.filestack=[],self.filenames=[],self.$element},updateStack:function(i,file){var self=this;return self.filestack[i]=file,self.filenames[i]=self._getFileName(file),self.$element},addToStack:function(file){var self=this;return self.filestack.push(file),self.filenames.push(self._getFileName(file)),self.$element},getFileStack:function(skipNull){var self=this;return self.filestack.filter(function(n){return skipNull?void 0!==n:void 0!==n&&null!==n})},lock:function(){var self=this;return self._resetErrors(),self.disable(),self.showRemove&&addCss(self.$container.find(".fileinput-remove"),"hide"),self.showCancel&&self.$container.find(".fileinput-cancel").removeClass("hide"),self._raise("filelock",[self.filestack,self._getExtraData()]),self.$element},unlock:function(reset){var self=this;return void 0===reset&&(reset=!0),self.enable(),self.showCancel&&addCss(self.$container.find(".fileinput-cancel"),"hide"),self.showRemove&&self.$container.find(".fileinput-remove").removeClass("hide"),reset&&self._resetFileStack(),self._raise("fileunlock",[self.filestack,self._getExtraData()]),self.$element},cancel:function(){var i,self=this,xhr=self.ajaxRequests,len=xhr.length;if(len>0)for(i=0;len>i;i+=1)self.cancelling=!0,xhr[i].abort();return self._setProgressCancelled(),self._getThumbs().each(function(){var $thumb=$(this),ind=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[ind]&&($thumb.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),$thumb.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),self.unlock()}),self.$element},clear:function(){var cap,self=this;return self.$btnUpload.removeAttr("disabled"),self._getThumbs().find("video,audio,img").each(function(){cleanMemory($(this))}),self._resetUpload(),self.clearStack(),self._clearFileInput(),self._resetErrors(!0),self._raise("fileclear"),self._hasInitialPreview()?(self._showFileIcon(),self._resetPreview(),self._initPreviewDeletes(),self.$container.removeClass("file-input-new")):(self._getThumbs().each(function(){self._clearObjects($(this))}),self.isUploadable&&(previewCache.data[self.id]={}),self.$preview.html(""),cap=!self.overwriteInitial&&self.initialCaption.length>0?self.initialCaption:"",self._setCaption(cap),self.$caption.attr("title",""),addCss(self.$container,"file-input-new"),self._validateDefaultPreview()),0===self.$container.find(".file-preview-frame").length&&(self._initCaption()||self.$captionContainer.find(".kv-caption-icon").hide()),self._hideFileIcon(),self._raise("filecleared"),self.$captionContainer.focus(),self._setFileDropZoneTitle(),self.$element},reset:function(){var self=this;return self._resetPreview(),self.$container.find(".fileinput-filename").text(""),self._raise("filereset"),addCss(self.$container,"file-input-new"),(self.$preview.find(".file-preview-frame").length||self.isUploadable&&self.dropZoneEnabled)&&self.$container.removeClass("file-input-new"),self._setFileDropZoneTitle(),self.clearStack(),self.formdata={},self.$element},disable:function(){var self=this;return self.isDisabled=!0,self._raise("filedisabled"),self.$element.attr("disabled","disabled"),self.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),self.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),self._initDragDrop(),self.$element},enable:function(){var self=this;return self.isDisabled=!1,self._raise("fileenabled"),self.$element.removeAttr("disabled"),self.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),self.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),self._initDragDrop(),self.$element},upload:function(){var i,outData,len,self=this,totLen=self.getFileStack().length,params={},hasExtraData=!$.isEmptyObject(self._getExtraData());if(self.minFileCount>0&&self._getFileCount(totLen)<self.minFileCount)return void self._noFilesError(params);if(self.isUploadable&&!self.isDisabled&&(0!==totLen||hasExtraData)){if(self._resetUpload(),self.$progress.removeClass("hide"),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.lock(),self._setProgress(2),0===totLen&&hasExtraData)return void self._uploadExtraOnly();if(len=self.filestack.length,self.hasInitData=!1,!self.uploadAsync)return self._uploadBatch(),self.$element;for(outData=self._getOutData(),self._raise("filebatchpreupload",[outData]),self.fileBatchCompleted=!1,self.uploadCache={content:[],config:[],tags:[],append:!0},self.uploadAsyncCount=self.getFileStack().length,i=0;len>i;i++)self.uploadCache.content[i]=null,self.uploadCache.config[i]=null,self.uploadCache.tags[i]=null;for(i=0;len>i;i++)void 0!==self.filestack[i]&&self._uploadSingle(i,self.filestack,!0)}},destroy:function(){var self=this,$cont=self.$container;return $cont.find(".file-drop-zone").off(),self.$element.insertBefore($cont).off(NAMESPACE).removeData(),$cont.off().remove(),self.$element},refresh:function(options){var self=this,$el=self.$element;return options=options?$.extend(!0,{},self.options,options):self.options,self.destroy(),$el.fileinput(options),$el.val()&&$el.trigger("change.fileinput"),$el}},$.fn.fileinput=function(option){if(hasFileAPISupport()||isIE(9)){var args=Array.apply(null,arguments),retvals=[];switch(args.shift(),this.each(function(){var opts,self=$(this),data=self.data("fileinput"),options="object"==typeof option&&option,lang=options.language||self.data("language")||"en",loc={};data||("en"===lang||isEmpty($.fn.fileinputLocales[lang])||(loc=$.fn.fileinputLocales[lang]),opts=$.extend(!0,{},$.fn.fileinput.defaults,$.fn.fileinputLocales.en,loc,options,self.data()),data=new FileInput(this,opts),self.data("fileinput",data)),"string"==typeof option&&retvals.push(data[option].apply(data,args))}),retvals.length){case 0:return this;case 1:return retvals[0];default:return retvals}}},$.fn.fileinput.defaults={language:"en",showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,autoReplace:!1,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:defaultLayoutTemplates,previewTemplates:defaultPreviewTemplates,allowedPreviewTypes:defaultPreviewTypes,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewSettings:defaultPreviewSettings,fileTypeSettings:defaultFileTypeSettings,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-icon-4x",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",maxFileSize:0,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",previewFileType:"image",zoomIndicator:'<i class="glyphicon glyphicon-zoom-in"></i>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;</span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},$.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgCancelled:"Cancelled",msgZoomTitle:"View details",msgZoomModalHeading:"Detailed Preview",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgUploadAborted:"The file upload was aborted",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",dropZoneTitle:"Drag & drop files here &hellip;"},$.fn.fileinput.Constructor=FileInput,$(document).ready(function(){var $input=$("input.file[type=file]");$input.length&&$input.fileinput()})});